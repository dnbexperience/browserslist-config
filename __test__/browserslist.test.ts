import { describe, it, expect } from 'vitest'
import { createRequire } from 'module'
import path from 'path'
import browserslist from 'browserslist'

const require = createRequire(import.meta.url)
const configPath = path.resolve(__dirname, '../browserslist.cjs')
const browserslistConfig = require(configPath).join(', ')

describe('Browserslist', () => {
  const config = browserslist(browserslistConfig)

  it('should include specific minimum browser version', () => {
    expect(config).toContain('chrome 109')
    expect(config).toContain('firefox 115')
    expect(config).toContain('edge 109')
    expect(config).toContain('opera 95')
    expect(config).toContain('safari 13.1')
    expect(config).toContain('ios_saf 13.0-13.1')
    expect(config).toContain('samsung 17.0')
  })

  it('should not include android browser', () => {
    expect(config.some((browser) => browser.includes('android'))).toBe(
      false
    )
  })

  it('should match expected browsers', () => {
    // The expected browsers
    const expectedBrowsers = [
      'and_chr 133',
      'and_ff 135',
      'chrome 109',
      'chrome 110',
      'chrome 111',
      'chrome 112',
      'chrome 113',
      'chrome 114',
      'chrome 115',
      'chrome 116',
      'chrome 117',
      'chrome 118',
      'chrome 119',
      'chrome 120',
      'chrome 121',
      'chrome 122',
      'chrome 123',
      'chrome 124',
      'chrome 125',
      'chrome 126',
      'chrome 127',
      'chrome 128',
      'chrome 129',
      'chrome 130',
      'chrome 131',
      'chrome 132',
      'chrome 133',
      'edge 109',
      'edge 110',
      'edge 111',
      'edge 112',
      'edge 113',
      'edge 114',
      'edge 115',
      'edge 116',
      'edge 117',
      'edge 118',
      'edge 119',
      'edge 120',
      'edge 121',
      'edge 122',
      'edge 123',
      'edge 124',
      'edge 125',
      'edge 126',
      'edge 127',
      'edge 128',
      'edge 129',
      'edge 130',
      'edge 131',
      'edge 132',
      'edge 133',
      'firefox 115',
      'firefox 116',
      'firefox 117',
      'firefox 118',
      'firefox 119',
      'firefox 120',
      'firefox 121',
      'firefox 122',
      'firefox 123',
      'firefox 124',
      'firefox 125',
      'firefox 126',
      'firefox 127',
      'firefox 128',
      'firefox 129',
      'firefox 130',
      'firefox 131',
      'firefox 132',
      'firefox 133',
      'firefox 134',
      'firefox 135',
      'ios_saf 13.0-13.1',
      'ios_saf 13.2',
      'ios_saf 13.3',
      'ios_saf 13.4-13.7',
      'ios_saf 14.0-14.4',
      'ios_saf 14.5-14.8',
      'ios_saf 15.0-15.1',
      'ios_saf 15.2-15.3',
      'ios_saf 15.4',
      'ios_saf 15.5',
      'ios_saf 15.6-15.8',
      'ios_saf 16.0',
      'ios_saf 16.1',
      'ios_saf 16.2',
      'ios_saf 16.3',
      'ios_saf 16.4',
      'ios_saf 16.5',
      'ios_saf 16.6-16.7',
      'ios_saf 17.0',
      'ios_saf 17.1',
      'ios_saf 17.2',
      'ios_saf 17.3',
      'ios_saf 17.4',
      'ios_saf 17.5',
      'ios_saf 17.6-17.7',
      'ios_saf 18.0',
      'ios_saf 18.1',
      'ios_saf 18.2',
      'ios_saf 18.3',
      'opera 100',
      'opera 101',
      'opera 102',
      'opera 103',
      'opera 104',
      'opera 105',
      'opera 106',
      'opera 107',
      'opera 108',
      'opera 109',
      'opera 110',
      'opera 111',
      'opera 112',
      'opera 113',
      'opera 114',
      'opera 95',
      'opera 96',
      'opera 97',
      'opera 98',
      'opera 99',
      'safari 13.1',
      'safari 14',
      'safari 14.1',
      'safari 15',
      'safari 15.1',
      'safari 15.2-15.3',
      'safari 15.4',
      'safari 15.5',
      'safari 15.6',
      'safari 16.0',
      'safari 16.1',
      'safari 16.2',
      'safari 16.3',
      'safari 16.4',
      'safari 16.5',
      'safari 16.6',
      'safari 17.0',
      'safari 17.1',
      'safari 17.2',
      'safari 17.3',
      'safari 17.4',
      'safari 17.5',
      'safari 17.6',
      'safari 18.0',
      'safari 18.1',
      'safari 18.2',
      'safari 18.3',
      'samsung 17.0',
      'samsung 18.0',
      'samsung 19.0',
      'samsung 20',
      'samsung 21',
      'samsung 22',
      'samsung 23',
      'samsung 24',
      'samsung 25',
      'samsung 26',
      'samsung 27',
    ].sort()

    expect(config.sort()).toEqual(expectedBrowsers)
  })
})
